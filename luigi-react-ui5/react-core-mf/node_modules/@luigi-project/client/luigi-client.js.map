{"version":3,"sources":["webpack://LuigiClient/webpack/universalModuleDefinition","webpack://LuigiClient/webpack/bootstrap","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/classCallCheck.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/createClass.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/getPrototypeOf.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/inherits.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/assertThisInitialized.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/slicedToArray.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/typeof.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/setPrototypeOf.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/arrayWithHoles.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js","webpack://LuigiClient/./node_modules/@babel/runtime/helpers/nonIterableRest.js","webpack://LuigiClient/./src/baseClass.js","webpack://LuigiClient/./src/helpers.js","webpack://LuigiClient/./src/lifecycleManager.js","webpack://LuigiClient/./src/splitViewHandle.js","webpack://LuigiClient/./src/linkManager.js","webpack://LuigiClient/./src/uxManager.js","webpack://LuigiClient/./src/storageManager.js","webpack://LuigiClient/./src/luigi-client.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","instance","Constructor","TypeError","_defineProperties","target","props","length","descriptor","configurable","writable","protoProps","staticProps","_typeof","assertThisInitialized","self","_getPrototypeOf","setPrototypeOf","getPrototypeOf","__proto__","subClass","superClass","constructor","ReferenceError","arrayWithHoles","iterableToArrayLimit","nonIterableRest","arr","obj","iterator","_setPrototypeOf","Array","isArray","toString","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","err","LuigiClientBase","this","promises","helpers","listeners","origin","helperListener","evt","data","msg","message","convertCustomMessageInternalToUser","filter","listener","id","map","eventFn","listenerId","addEventListener","internalMessage","getRandomId","Boolean","find","crypto","msCrypto","getRandomValues","Uint32Array","item","setLuigiCoreDomain","parent","postMessage","error","console","warn","path","toLowerCase","includes","paramsMap","entries","reduce","sanitizedMap","paramPair","deSanitizeParam","param","String","replaceAll","lifecycleManager","luigiInitialized","defaultContextKeys","setCurrentContext","acc","_onContextUpdatedFns","_onInactiveFns","_onInitFns","authData","_isDeferInitDefined","luigiClientInit","document","head","hasAttribute","setContext","rawData","index","JSON","parse","e","info","setAuthData","eventPayload","_notifyInit","sendPostMessageToLuigiCore","_notifyInactive","currentContext","internal","isNavigateBack","withoutSync","previousHash","location","hash","history","replaceState","luigiInduced","viewUrl","dispatchEvent","PopStateEvent","state","HashChangeEvent","assign","context","pathParams","_notifyUpdate","clientVersion","require","version","_tpcCheck","luigiCookie","luigiCookieKey","tpc","cookies","cookie","split","trim","objWithFns","payload","isFunction","_callAllFns","initFn","getLuigiCoreDomain","contextUpdatedFn","inactiveFn","customMessageId","customMessageListener","customMessage","removeEventListener","accessToken","getEventData","activeFeatureToggleList","params","keepBrowserHistory","shouldDesanitise","deSanitizeParamsMap","nodeParams","searchParams","clientPermissions","setTargetOrigin","customMessageInternal","convertCustomMessageUserToInternal","userSettings","anchor","splitViewHandle","settings","validSplitViewEvents","splitView","exists","size","collapsed","on","newSize","forEach","action","sendSplitViewEvent","callback","filterParam","linkManager","values","options","preserveView","errorSkipNavigation","fromContext","fromClosestContext","fromVirtualTreeRoot","fromParent","relative","link","newTab","preserveQueryParams","preventContextUpdate","preventHistoryEntry","sessionId","modalSettings","splitViewSettings","drawerSettings","relativePath","navigationOpenMsg","intent","hasIntent","modal","drawer","addHistoryEntry","semanticSlug","newPath","paramList","slice","navigate","updatedModalSettings","navigationContext","parentNavigationContexts","indexOf","isObject","currentId","pathExistsPromises","getPromise","resolveFn","then","setPromise","correlationId","pathExists","pathExistsMsg","viewStackSize","goBackValue","goBackContext","stringify","preserve","currentRoutePromise","route","uxManager","currentLocale","isDirty","dirty","hideConfirmationModal","confirmationModalPromise","promise","Promise","resolve","reject","rejectFn","confirmed","hideAlert","closeAfter","alertPromises","dismissKey","alerts","locale","currentTheme","pendingOperation","Map","StorageManager","storageEventProcessor","StorageEventProcessor","processEvent","execute","has","log","promiseOperations","status","result","delete","start","Date","getTime","syncOperation","operation","createPendingOperation","sendMessage","set","storageManager","LuigiClient","top","getAttribute","pushState","errorObj","filename","lineno","colno","addInitListener","removeInitListener","addContextUpdateListener","removeContextUpdateListener","getToken","getContext","addNodeParams","getNodeParams","getActiveFeatureToggles","getPathParams","getCoreSearchParams","addCoreSearchParams","getClientPermissions","sendCustomMessage","messageId","addCustomMessageListener","removeCustomMessageListener","addInactiveListener","removeInactiveListener","getUserSettings","isLuigiClientInitialized","getAnchor","setAnchor"],"mappings":"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","file":"luigi-client.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LuigiClient\"] = factory();\n\telse\n\t\troot[\"LuigiClient\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 13);\n","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","var _typeof = require(\"../helpers/typeof\");\n\nvar assertThisInitialized = require(\"./assertThisInitialized\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn;","function _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf;","var setPrototypeOf = require(\"./setPrototypeOf\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits;","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized;","var arrayWithHoles = require(\"./arrayWithHoles\");\n\nvar iterableToArrayLimit = require(\"./iterableToArrayLimit\");\n\nvar nonIterableRest = require(\"./nonIterableRest\");\n\nfunction _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || nonIterableRest();\n}\n\nmodule.exports = _slicedToArray;","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    module.exports = _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    module.exports = _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nmodule.exports = _typeof;","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf;","function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nmodule.exports = _arrayWithHoles;","function _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nmodule.exports = _iterableToArrayLimit;","function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nmodule.exports = _nonIterableRest;","/**\n * @private\n * @abstract\n */\nexport class LuigiClientBase {\n  /**\n   * @private\n   */\n  constructor() {\n    this.promises = {};\n  }\n  /**\n   * Returns the promises object\n   * @private\n   */\n  setPromise(name, value) {\n    this.promises[name] = value;\n  }\n  /**\n   * Sets the promises object\n   * @private\n   */\n  getPromise(name) {\n    return this.promises[name];\n  }\n}\n","/** @private */\nclass Helpers {\n  /** @private */\n  constructor() {\n    this.listeners = [];\n    this.origin = '';\n\n    const helperListener = function(evt) {\n      if (!evt.data.msg) {\n        return;\n      }\n      if (evt.data.msg === 'custom') {\n        const message = this.convertCustomMessageInternalToUser(evt.data);\n        this.listeners\n          .filter(listener => listener.name === message.id)\n          .map(listener => listener.eventFn(message, listener.listenerId));\n      } else {\n        this.listeners\n          .filter(listener => listener.name === evt.data.msg)\n          .map(listener => listener.eventFn(evt, listener.listenerId));\n      }\n    }.bind(this);\n\n    window.addEventListener('message', helperListener);\n  }\n\n  convertCustomMessageInternalToUser(internalMessage) {\n    return internalMessage.data;\n  }\n\n  convertCustomMessageUserToInternal(message) {\n    return {\n      msg: 'custom',\n      data: message\n    };\n  }\n\n  convertStorageMessageToInternal(message) {\n    return {\n      msg: 'storage',\n      data: message\n    };\n  }\n\n  /**\n   * Registers a post message listener\n   * Don't forget to remove the event listener at the end of\n   * your eventFn if you do not need it anymore.\n   * @private\n   * @param {string} name event name\n   * @param {function} eventFn callback function\n   * @returns {string} listener id\n   */\n  addEventListener(name, eventFn) {\n    const listenerId = this.getRandomId();\n    this.listeners.push({\n      name,\n      eventFn,\n      listenerId\n    });\n    return listenerId;\n  }\n\n  /**\n   * Removes a post message listener\n   * @private\n   * @param {string} id listenerId\n   */\n  removeEventListener(id) {\n    const listenerExists = Boolean(this.listeners.find(l => l.listenerId === id));\n    if (listenerExists) {\n      this.listeners = this.listeners.filter(l => l.listenerId !== id);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Creates a random Id\n   * @private\n   */\n  getRandomId() {\n    // window.msCrypto for IE 11\n    return (window.crypto || window.msCrypto).getRandomValues(new Uint32Array(1))[0];\n  }\n\n  /**\n   * Simple function check.\n   * @private\n   * @param {function} item\n   * @returns {boolean}\n   */\n  isFunction(item) {\n    return typeof item === 'function';\n  }\n\n  /**\n   * Simple object check.\n   * @private\n   * @param {Object} item\n   * @returns {boolean}\n   */\n  isObject(item) {\n    return Object.prototype.toString.call(item) === '[object Object]';\n  }\n\n  getLuigiCoreDomain() {\n    return this.origin;\n  }\n\n  setLuigiCoreDomain(origin) {\n    // protect against \"null\" string set by at least Chrome browser when file protocol used\n    if (origin && origin !== 'null') {\n      this.origin = origin;\n    }\n  }\n\n  setTargetOrigin(origin) {\n    this.setLuigiCoreDomain(origin);\n  }\n\n  sendPostMessageToLuigiCore(msg) {\n    if (this.origin) {\n      // protect against potential postMessage problems, since origin value may be set incorrectly\n      try {\n        window.parent.postMessage(msg, this.origin);\n      } catch (error) {\n        console.warn('Unable to post message ' + msg + ' to Luigi Core from origin ' + this.origin + ': ' + error);\n      }\n    } else {\n      console.warn(\n        'There is no target origin set. You can specify the target origin by calling LuigiClient.setTargetOrigin(\"targetorigin\") in your micro frontend.'\n      );\n    }\n  }\n\n  /**\n   * Checks if given path contains intent navigation special syntax\n   * @param {string} path to check\n   */\n  hasIntent(path) {\n    return !!path && path.toLowerCase().includes('#?intent=');\n  }\n\n  deSanitizeParamsMap(paramsMap) {\n    return Object.entries(paramsMap).reduce((sanitizedMap, paramPair) => {\n      sanitizedMap[this.deSanitizeParam(paramPair[0])] = this.deSanitizeParam(paramPair[1]);\n      return sanitizedMap;\n    }, {});\n  }\n\n  deSanitizeParam(param = '') {\n    return String(param)\n      .replaceAll('&lt;', '<')\n      .replaceAll('&gt;', '>')\n      .replaceAll('&quot;', '\"')\n      .replaceAll('&#39;', \"'\")\n      .replaceAll('&sol;', '/');\n  }\n}\n\nexport const helpers = new Helpers();\n","import { LuigiClientBase } from './baseClass';\nimport { helpers } from './helpers';\n\n/**\n * Use the functions and parameters to define the Lifecycle of listeners, navigation nodes, and Event data.\n * @name Lifecycle\n */\nclass LifecycleManager extends LuigiClientBase {\n  /** @private */\n  constructor() {\n    super();\n    this.luigiInitialized = false;\n    this.defaultContextKeys = ['context', 'internal', 'nodeParams', 'pathParams', 'searchParams'];\n    this.setCurrentContext(\n      this.defaultContextKeys.reduce(function(acc, key) {\n        acc[key] = {};\n        return acc;\n      }, {})\n    );\n\n    this._onContextUpdatedFns = {};\n    this._onInactiveFns = {};\n    this._onInitFns = {};\n    this.authData = {};\n\n    if (!this._isDeferInitDefined()) {\n      this.luigiClientInit();\n    }\n  }\n\n  /**\n   * Check if the html head element contains the attribute \"defer-luigi-init\"\n   * @private\n   * @memberof Lifecycle\n   */\n  _isDeferInitDefined() {\n    return window.document.head.hasAttribute('defer-luigi-init');\n  }\n\n  /**\n   * Check if LuigiClient is initialized\n   * @returns {boolean} client initialized state\n   * @since 1.12.0\n   * @memberof Lifecycle\n   * @example\n   * const init = LuigiClient.isLuigiClientInitialized()\n   */\n  isLuigiClientInitialized() {\n    return this.luigiInitialized;\n  }\n\n  /**\n   * Starts the handshake with Luigi Core and thereafter results in initialization of Luigi Client. It is always ran by default when importing the Luigi Client package in your micro frontend. Note that when using `defer-luigi-init` to defer default initialization, you will need to initialize the handshake using this function manually wherever needed.\n   * @since 1.12.0\n   * @memberof Lifecycle\n   * @example\n   * LuigiClient.luigiClientInit()\n   */\n  luigiClientInit() {\n    if (this.luigiInitialized) {\n      console.warn('Luigi Client has been already initialized');\n      return;\n    }\n    /**\n     * Save context data every time navigation to a different node happens\n     * @private\n     */\n    const setContext = rawData => {\n      for (let index = 0; index < this.defaultContextKeys.length; index++) {\n        let key = this.defaultContextKeys[index];\n        try {\n          if (typeof rawData[key] === 'string') {\n            rawData[key] = JSON.parse(rawData[key]);\n          }\n        } catch (e) {\n          console.info('unable to parse luigi context data for', key, rawData[key], e);\n        }\n      }\n      this.setCurrentContext(rawData);\n    };\n\n    const setAuthData = eventPayload => {\n      if (eventPayload) {\n        this.authData = eventPayload;\n      }\n    };\n\n    helpers.addEventListener('luigi.init', e => {\n      setContext(e.data);\n      setAuthData(e.data.authData);\n      helpers.setLuigiCoreDomain(e.origin);\n      this.luigiInitialized = true;\n      this._notifyInit(e.origin);\n      helpers.sendPostMessageToLuigiCore({ msg: 'luigi.init.ok' });\n    });\n\n    helpers.addEventListener('luigi-client.inactive-microfrontend', e => {\n      this._notifyInactive(e.origin);\n    });\n\n    helpers.addEventListener('luigi.auth.tokenIssued', e => {\n      setAuthData(e.data.authData);\n    });\n\n    helpers.addEventListener('luigi.navigate', e => {\n      setContext(e.data);\n      if (!this.currentContext.internal.isNavigateBack && !this.currentContext.withoutSync) {\n        const previousHash = window.location.hash;\n        history.replaceState({ luigiInduced: true }, '', e.data.viewUrl);\n        window.dispatchEvent(new PopStateEvent('popstate', { state: 'luiginavigation' }));\n        if (window.location.hash !== previousHash) {\n          window.dispatchEvent(new HashChangeEvent('hashchange'));\n        }\n      }\n      // pass additional data to context to enable micro frontend developer to act on internal routing change\n      if (this.currentContext.withoutSync) {\n        Object.assign(this.currentContext.context, {\n          viewUrl: e.data.viewUrl ? e.data.viewUrl : undefined,\n          pathParams: e.data.pathParams ? e.data.pathParams : undefined\n        });\n      }\n      // execute the context change listener if set by the micro frontend\n      this._notifyUpdate();\n      helpers.sendPostMessageToLuigiCore({ msg: 'luigi.navigate.ok' });\n    });\n\n    /**\n     * Get context once initially\n     * @private\n     */\n    window.parent.postMessage(\n      {\n        msg: 'luigi.get-context',\n        clientVersion: require('../public/package.json').version\n      },\n      '*'\n    );\n    this._tpcCheck();\n  }\n\n  _tpcCheck() {\n    let tpc = 'enabled';\n    let cookies = document.cookie;\n    let luigiCookie;\n    let luigiCookieKey;\n    if (cookies) {\n      luigiCookie = cookies\n        .split(';')\n        .map(cookie => cookie.trim())\n        .find(cookie => cookie == 'luigiCookie=true');\n    }\n    if (luigiCookie === 'luigiCookie=true') {\n      luigiCookieKey = luigiCookie.split('=')[0];\n      document.cookie = luigiCookieKey + '=; Max-Age=-99999999;';\n    }\n    document.cookie = 'luigiCookie=true; SameSite=None; Secure';\n    cookies = document.cookie;\n    if (cookies) {\n      luigiCookie = cookies\n        .split(';')\n        .map(cookie => cookie.trim())\n        .find(cookie => cookie == 'luigiCookie=true');\n    }\n    if (luigiCookie === 'luigiCookie=true') {\n      window.parent.postMessage({ msg: 'luigi.third-party-cookie', tpc }, '*');\n      document.cookie = luigiCookieKey + '=; Max-Age=-99999999;';\n    } else {\n      tpc = 'disabled';\n      window.parent.postMessage({ msg: 'luigi.third-party-cookie', tpc }, '*');\n      console.warn('Third party cookies are not supported!');\n    }\n  }\n\n  /**\n   * Iterates over an object and executes all top-level functions\n   * with a given payload.\n   * @private\n   * @memberof Lifecycle\n   */\n  _callAllFns(objWithFns, payload, origin) {\n    for (let id in objWithFns) {\n      if (objWithFns.hasOwnProperty(id) && helpers.isFunction(objWithFns[id])) {\n        objWithFns[id](payload, origin);\n      }\n    }\n  }\n\n  /**\n   * Notifies all context init listeners.\n   * @private\n   * @memberof Lifecycle\n   */\n  _notifyInit(origin) {\n    this._callAllFns(this._onInitFns, this.currentContext.context, origin);\n  }\n\n  /**\n   * Notifies all context update listeners.\n   * @private\n   * @memberof Lifecycle\n   */\n  _notifyUpdate() {\n    this._callAllFns(this._onContextUpdatedFns, this.currentContext.context);\n  }\n\n  /**\n   * Notifies all inactive listeners.\n   * @private\n   * @memberof Lifecycle\n   */\n  _notifyInactive() {\n    this._callAllFns(this._onInactiveFns);\n  }\n\n  /**\n   * @private\n   * @memberof Lifecycle\n   */\n  setCurrentContext(value) {\n    this.currentContext = value;\n  }\n\n  /**\n   * Registers a listener called with the context object and the Luigi Core domain as soon as Luigi is instantiated. Defer your application bootstrap if you depend on authentication data coming from Luigi.\n   * @param {Lifecycle~initListenerCallback} initFn the function that is called once Luigi is initialized, receives current context and origin as parameters\n   * @memberof Lifecycle\n   * @example\n   * const initListenerId = LuigiClient.addInitListener((context) => storeContextToMF(context))\n   */\n  addInitListener(initFn) {\n    const id = helpers.getRandomId();\n    this._onInitFns[id] = initFn;\n    if (this.luigiInitialized && helpers.isFunction(initFn)) {\n      initFn(this.currentContext.context, helpers.getLuigiCoreDomain());\n    }\n    return id;\n  }\n\n  /**\n   * Callback of the addInitListener\n   * @callback Lifecycle~initListenerCallback\n   * @param {Object} context current context data\n   * @param {string} origin Luigi Core URL\n   */\n  /**\n   * Removes an init listener.\n   * @param {string} id the id that was returned by the `addInitListener` function.\n   * @memberof Lifecycle\n   * @example\n   * LuigiClient.removeInitListener(initListenerId)\n   */\n  removeInitListener(id) {\n    if (this._onInitFns[id]) {\n      this._onInitFns[id] = undefined;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Registers a listener called with the context object when the URL is changed. For example, you can use this when changing environments in a context switcher in order for the micro frontend to do an API call to the environment picked.\n   * @param {function} contextUpdatedFn the listener function called each time Luigi context changes\n   * @memberof Lifecycle\n   * @example\n   * const updateListenerId = LuigiClient.addContextUpdateListener((context) => storeContextToMF(context))\n   */\n  addContextUpdateListener(contextUpdatedFn) {\n    const id = helpers.getRandomId();\n    this._onContextUpdatedFns[id] = contextUpdatedFn;\n    if (this.luigiInitialized && helpers.isFunction(contextUpdatedFn)) {\n      contextUpdatedFn(this.currentContext.context);\n    }\n    return id;\n  }\n\n  /**\n   * Removes a context update listener.\n   * @param {string} id the id that was returned by the `addContextUpdateListener` function\n   * @memberof Lifecycle\n   * @example\n   * LuigiClient.removeContextUpdateListener(updateListenerId)\n   */\n  removeContextUpdateListener(id) {\n    if (this._onContextUpdatedFns[id]) {\n      this._onContextUpdatedFns[id] = undefined;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Registers a listener called upon micro frontend inactivity. This happens when a new micro frontend gets shown while keeping the old one cached.\n   * Gets called when:\n   * - navigating with **preserveView**\n   * - navigating from or to a **viewGroup**\n   *\n   * Does not get called when navigating normally, or when `openAsModal` or `openAsSplitView` are used.\n   * Once the micro frontend turns back into active state, the `addContextUpdateListener` receives an updated context.\n   * @param {function} inactiveFn the listener function called each time a micro frontend turns into an inactive state\n   * @memberof Lifecycle\n   * @example\n   * LuigiClient.addInactiveListener(() => mfIsInactive = true)\n   * const inactiveListenerId = LuigiClient.addInactiveListener(() => mfIsInactive = true)\n   */\n  addInactiveListener(inactiveFn) {\n    const id = helpers.getRandomId();\n    this._onInactiveFns[id] = inactiveFn;\n    return id;\n  }\n\n  /**\n   * Removes a listener for inactive micro frontends.\n   * @param {string} id the id that was returned by the `addInactiveListener` function\n   * @memberof Lifecycle\n   * @example\n   * LuigiClient.removeInactiveListener(inactiveListenerId)\n   */\n  removeInactiveListener(id) {\n    if (this._onInactiveFns[id]) {\n      this._onInactiveFns[id] = undefined;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Registers a listener called when the micro frontend receives a custom message.\n   * @param {string} customMessageId the custom message id\n   * @param {Lifecycle~customMessageListenerCallback} customMessageListener the function that is called when the micro frontend receives the corresponding event\n   * @memberof Lifecycle\n   * @since 0.6.2\n   * @example\n   * const customMsgId = LuigiClient.addCustomMessageListener('myapp.project-updated', (data) => doSomething(data))\n   */\n  addCustomMessageListener(customMessageId, customMessageListener) {\n    return helpers.addEventListener(customMessageId, (customMessage, listenerId) => {\n      return customMessageListener(customMessage, listenerId);\n    });\n  }\n\n  /**\n   * Callback of the customMessageListener\n   * @callback Lifecycle~customMessageListenerCallback\n   * @param {Object} customMessage custom message object\n   * @param {string} customMessage.id message id\n   * @param {*} customMessage.MY_DATA_FIELD any other message data field\n   * @param {string} listenerId custom message listener id to be used for unsubscription\n   */\n  /**\n   * Removes a custom message listener.\n   * @param {string} id the id that was returned by the `addInitListener` function\n   * @memberof Lifecycle\n   * @since 0.6.2\n   * LuigiClient.removeCustomMessageListener(customMsgId)\n   */\n  removeCustomMessageListener(id) {\n    return helpers.removeEventListener(id);\n  }\n\n  /**\n   * Returns the currently valid access token.\n   * @returns {string} current access token\n   * @memberof Lifecycle\n   * @example\n   * const accessToken = LuigiClient.getToken()\n   */\n  getToken() {\n    return this.authData.accessToken;\n  }\n\n  /**\n   * Returns the context object. Typically it is not required as the {@link #addContextUpdateListener addContextUpdateListener()} receives the same values.\n   * @returns {Object} current context data\n   * @memberof Lifecycle\n   * @example\n   * const context = LuigiClient.getContext()\n   */\n  getContext() {\n    return this.getEventData();\n  }\n\n  /**\n   * Returns the context object. It is an alias function for getContext().\n   * @returns {Object} current context data\n   * @memberof Lifecycle\n   * @deprecated\n   */\n  getEventData() {\n    return this.currentContext.context;\n  }\n\n  /**\n   * Returns a list of active feature toggles\n   * @returns {Array} a list of feature toggle names\n   * @memberof Lifecycle\n   * @since 1.4.0\n   * @example\n   * const activeFeatureToggleList = LuigiClient.getActiveFeatureToggles()\n   */\n  getActiveFeatureToggles() {\n    return this.currentContext.internal.activeFeatureToggleList;\n  }\n\n  /**\n   * Sets node parameters in Luigi Core. The parameters will be added to the URL.\n   * @param {Object} params\n   * @param {boolean} keepBrowserHistory\n   * @memberof Lifecycle\n   * @example\n   * LuigiClient.addNodeParams({luigi:'rocks'}, true);\n   */\n  addNodeParams(params, keepBrowserHistory = true) {\n    if (params) {\n      helpers.sendPostMessageToLuigiCore({\n        msg: 'luigi.addNodeParams',\n        data: params,\n        keepBrowserHistory\n      });\n    }\n  }\n\n  /**\n   * Returns the node parameters of the active URL.\n   * Node parameters are defined like URL query parameters but with a specific prefix allowing Luigi to pass them to the micro frontend view. The default prefix is **~** and you can use it in the following way: `https://my.luigi.app/home/products?~sort=asc&~page=3`.\n   * <!-- add-attribute:class:warning -->\n   * > **NOTE:** some special characters (`<`, `>`, `\"`, `'`, `/`) in node parameters are HTML-encoded.\n   * @param {boolean} shouldDesanitise defines whether the specially encoded characters should be desanitised\n   * @returns {Object} node parameters, where the object property name is the node parameter name without the prefix, and its value is the value of the node parameter. For example `{sort: 'asc', page: 3}`\n   * @memberof Lifecycle\n   * @example\n   * const nodeParams = LuigiClient.getNodeParams()\n   * const nodeParams = LuigiClient.getNodeParams(true)\n   */\n  getNodeParams(shouldDesanitise = false) {\n    return shouldDesanitise\n      ? helpers.deSanitizeParamsMap(this.currentContext.nodeParams)\n      : this.currentContext.nodeParams;\n  }\n\n  /**\n   * Returns the dynamic path parameters of the active URL.\n   * Path parameters are defined by navigation nodes with a dynamic **pathSegment** value starting with **:**, such as **productId**.\n   * All path parameters in the current navigation path (as defined by the active URL) are returned.\n   * <!-- add-attribute:class:warning -->\n   * > **NOTE:** some special characters (`<`, `>`, `\"`, `'`, `/`) in path parameters are HTML-encoded.\n   * @returns {Object} path parameters, where the object property name is the path parameter name without the prefix, and its value is the actual value of the path parameter. For example ` {productId: 1234, ...}`\n   * @memberof Lifecycle\n   * @example\n   * const pathParams = LuigiClient.getPathParams()\n   */\n  getPathParams() {\n    return this.currentContext.pathParams;\n  }\n\n  /**\n   * Read search query parameters which are sent from Luigi Core\n   * @memberof Lifecycle\n   * @returns Core search query parameters\n   * @example\n   * LuigiClient.getCoreSearchParams();\n   */\n  getCoreSearchParams() {\n    return this.currentContext.searchParams || {};\n  }\n\n  /**\n   * Sends search query parameters to Luigi Core. The search parameters will be added to the URL if they are first allowed on a node level using {@link navigation-parameters-reference.md#clientpermissionsurlparameters clientPermissions.urlParameters}.\n\n   * @param {Object} searchParams\n   * @param {boolean} keepBrowserHistory\n   * @memberof Lifecycle\n   * @example\n   * LuigiClient.addCoreSearchParams({luigi:'rocks'}, false);\n   */\n  addCoreSearchParams(searchParams, keepBrowserHistory = true) {\n    if (searchParams) {\n      helpers.sendPostMessageToLuigiCore({\n        msg: 'luigi.addSearchParams',\n        data: searchParams,\n        keepBrowserHistory\n      });\n    }\n  }\n\n  /**\n   * Returns the current client permissions as specified in the navigation node or an empty object. For details, see [Node parameters](navigation-parameters-reference.md).\n   * @returns {Object} client permissions as specified in the navigation node\n   * @memberof Lifecycle\n   * @example\n   * const permissions = LuigiClient.getClientPermissions()\n   */\n  getClientPermissions() {\n    return this.currentContext.internal.clientPermissions || {};\n  }\n\n  /**\n   * When the micro frontend is not embedded in the Luigi Core application and there is no init handshake you can set the target origin that is used in postMessage function calls by Luigi Client. Typically used only in custom micro-frontend frameworks that are compatible with LuigiClient API.\n   * @param {string} origin target origin\n   * @memberof Lifecycle\n   * @since 0.7.3\n   * @example\n   * LuigiClient.setTargetOrigin(window.location.origin)\n   */\n  setTargetOrigin(origin) {\n    helpers.setTargetOrigin(origin);\n  }\n\n  /**\n   * Sends a custom message to the Luigi Core application.\n   * @param {Object} message an object containing data to be sent to the Luigi Core to process it further. This object is set as an input parameter of the custom message listener on the Luigi Core side\n   * @param {string} message.id a string containing the message id\n   * @param {*} message.MY_DATA_FIELD any other message data field\n   * @example\n   * LuigiClient.sendCustomMessage({id: 'environment.created', production: false})\n   * LuigiClient.sendCustomMessage({id: 'environment.created', data: environmentDataObj})\n   * @memberof Lifecycle\n   * @since 0.6.2\n   */\n  sendCustomMessage(message) {\n    const customMessageInternal = helpers.convertCustomMessageUserToInternal(message);\n    helpers.sendPostMessageToLuigiCore(customMessageInternal);\n  }\n\n  /**\n   * Returns the current user settings based on the selected node.\n   * @returns {Object} current user settings\n   * @since 1.7.1\n   * @memberof Lifecycle\n   * @example\n   * const userSettings = LuigiClient.getUserSettings()\n   */\n  getUserSettings() {\n    return this.currentContext.internal.userSettings;\n  }\n\n  /**\n   * Returns the current anchor based on active URL.\n   * @memberof Lifecycle\n   * @since 1.21.0\n   * @returns anchor of URL\n   * @example\n   * LuigiClient.getAnchor();\n   */\n  getAnchor() {\n    return this.currentContext.internal.anchor || '';\n  }\n\n  /**\n   * Sends anchor to Luigi Core. The anchor will be added to the URL.\n   * @param {string} anchor\n   * @since 1.21.0\n   * @memberof Lifecycle\n   * @example\n   * LuigiClient.setAnchor('luigi');\n   */\n  setAnchor(anchor) {\n    helpers.sendPostMessageToLuigiCore({\n      msg: 'luigi.setAnchor',\n      anchor\n    });\n  }\n}\nexport const lifecycleManager = new LifecycleManager();\n","import { LuigiClientBase } from './baseClass';\nimport { helpers } from './helpers';\n\n/**\n * Split view \n  Allows to open a micro frontend in a split screen in the lower part of the content area. Open it by calling `const splitViewHandle = LuigiClient.linkManager().openAsSplitView`. \n  At a given time, you can open only one split view. It closes automatically when you navigate to a different route.\n  When you call `handle.collapse()`, the split view gets destroyed. It recreates when you use `handle.expand()`.\n  `openAsSplitView` returns an instance of the split view handle. The functions, actions, and event handlers listed below allow you to control and manage the split view.\n  * @name splitView\n  * @since 0.6.0\n  */\nexport class splitViewHandle extends LuigiClientBase {\n  /**\n   * @private\n   */\n  constructor(settings) {\n    super();\n\n    this.validSplitViewEvents = ['expand', 'collapse', 'resize', 'close'];\n\n    this.splitView = {\n      exists: true,\n      size: 40,\n      collapsed: false\n    };\n\n    Object.assign(this.splitView, settings);\n\n    const removeSplitViewListeners = () => {\n      this.splitView.listeners.forEach(id => helpers.removeEventListener(id));\n    };\n\n    this.splitView.listeners = [\n      helpers.addEventListener(`luigi.navigation.splitview.internal`, e => {\n        Object.assign(this.splitView, e.data.data);\n      })\n    ];\n    this.on('resize', newSize => {\n      this.splitView.size = newSize;\n    });\n    this.on('close', removeSplitViewListeners);\n  }\n  /*\n   * @private\n   */\n  sendSplitViewEvent(action, data) {\n    helpers.sendPostMessageToLuigiCore({\n      msg: `luigi.navigation.splitview.${action}`,\n      data\n    });\n  }\n\n  /**\n   * Collapses the split view\n   * @memberof splitView\n   * @since 0.6.0\n   * @example\n   * splitViewHandle.collapse();\n   */\n  collapse() {\n    this.sendSplitViewEvent('collapse');\n  }\n  /**\n   * Expands the split view\n   * @memberof splitView\n   * @since 0.6.0\n   * @example\n   * splitViewHandle.expand();\n   */\n  expand() {\n    this.sendSplitViewEvent('expand');\n  }\n\n  /**\n   * Closes and destroys the split view\n   * @memberof splitView\n   * @since 0.6.0\n   * @example\n   * splitViewHandle.close();\n   */\n  close() {\n    this.sendSplitViewEvent('close');\n  }\n  /**\n   * Sets the height of the split view\n   * @memberof splitView\n   * @param {number} value lower height in percent\n   * @since 0.6.0\n   * @example\n   * splitViewHandle.setSize(60);\n   */\n  setSize(value) {\n    this.sendSplitViewEvent('resize', value);\n  }\n  /**\n   * Registers a listener for split view events\n   * @memberof splitView\n   * @param {('expand'|'collapse'|'resize'|'close')} name event name\n   * @param {function} callback gets called when this event gets triggered by Luigi\n   * @returns {string} listener id\n   * @since 0.6.0\n   * @example\n   * const listenerId = splitViewHandle.on('expand', () => {});\n   * const listenerId = splitViewHandle.on('collapse', () => {});\n   * const listenerId = splitViewHandle.on('resize', () => {});\n   * const listenerId = splitViewHandle.on('close', () => {});\n   **/\n  on(name, callback) {\n    if (!this.validSplitViewEvents.includes(name)) {\n      console.warn(name + ' is not a valid split view event');\n      return false;\n    }\n    const id = helpers.addEventListener(`luigi.navigation.splitview.${name}.ok`, e => {\n      const filterParam = typeof e.data.data == 'number' ? e.data.data : undefined;\n      callback(filterParam);\n    });\n    this.splitView.listeners.push(id);\n    return id;\n  }\n  /**\n   * Unregisters a split view listener\n   * @memberof splitView\n   * @param {string} id listener id\n   * @since 0.6.0\n   * @example\n   * splitViewHandle.removeEventListener(listenerId);\n   */\n  removeEventListener(id) {\n    return helpers.removeEventListener(id);\n  }\n\n  /**\n   * Gets the split view status\n   * @memberof splitView\n   * @returns {boolean} true if a split view is loaded\n   * @since 0.6.0\n   * @example\n   * splitViewHandle.exists();\n   */\n  exists() {\n    return this.splitView.exists;\n  }\n  /**\n   * Reads the size of the split view\n   * @memberof splitView\n   * @returns {number} height in percent\n   * @since 0.6.0\n   * @example\n   * splitViewHandle.getSize();\n   */\n  getSize() {\n    return this.splitView.size;\n  }\n  /**\n   * Reads the collapse status\n   * @memberof splitView\n   * @returns {boolean} true if the split view is currently collapsed\n   * @since 0.6.0\n   * @example\n   * splitViewHandle.isCollapsed();\n   */\n  isCollapsed() {\n    return this.splitView.collapsed;\n  }\n  /**\n   * Reads the expand status\n   * @memberof splitView\n   * @returns {boolean} true if the split view is currently expanded\n   * @since 0.6.0\n   * @example\n   * splitViewHandle.isExpanded();\n   */\n  isExpanded() {\n    return !this.splitView.collapsed;\n  }\n}\n","import { LuigiClientBase } from './baseClass';\nimport { helpers } from './helpers';\nimport { splitViewHandle } from './splitViewHandle';\n\n/**\n * The Link Manager allows you to navigate to another route. Use it instead of an internal router to:\n  - Provide routing inside micro frontends.\n  - Reflect the route.\n  - Keep the navigation state in Luigi.\n  * @name linkManager\n  */\nexport class linkManager extends LuigiClientBase {\n  /**\n   * @private\n   */\n  constructor(values) {\n    super();\n    Object.assign(this, values);\n\n    this.options = {\n      preserveView: false,\n      nodeParams: {},\n      errorSkipNavigation: false,\n      fromContext: null,\n      fromClosestContext: false,\n      fromVirtualTreeRoot: false,\n      fromParent: false,\n      relative: false,\n      link: '',\n      newTab: false,\n      preserveQueryParams: false,\n      anchor: '',\n      preventContextUpdate: false,\n      preventHistoryEntry: false\n    };\n  }\n\n  /**\n   * Navigates to the given path in the application hosted by Luigi. It contains either a full absolute path or a relative path without a leading slash that uses the active route as a base. This is the standard navigation.\n   * @memberof linkManager\n   * @param {string} path path to be navigated to\n   * @param {string} sessionId current Luigi **sessionId**\n   * @param {boolean} preserveView preserve a view by setting it to `true`. It keeps the current view opened in the background and opens the new route in a new frame. Use the {@link #goBack goBack()} function to navigate back. You can use this feature across different levels. Preserved views are discarded as soon as you use the standard {@link #navigate navigate()} function instead of {@link #goBack goBack()}\n   * @param {Object} modalSettings opens a view in a modal. Use these settings to configure the modal's title and size\n   * @param {string} modalSettings.title modal title. By default, it is the node label. If there is no label, it is left empty\n   * @param {('fullscreen'|'l'|'m'|'s')} [modalSettings.size=\"l\"] size of the modal\n   * @param {string} modalSettings.width lets you specify a precise width for the modal. Allowed units are 'px', '%', 'rem', 'em', 'vh' and 'vw'.\n   * @param {string} modalSettings.height lets you specify a precise height for the modal. Allowed units are 'px', '%', 'rem', 'em', 'vh' and 'vw'.\n   * @param {Object} splitViewSettings opens a view in a split view. Use these settings to configure the split view's behaviour\n   * @param {string} splitViewSettings.title split view title. By default, it is the node label. If there is no label, it is left empty\n   * @param {number} [splitViewSettings.size=40] height of the split view in percent\n   * @param {boolean} [splitViewSettings.collapsed=false] creates split view but leaves it closed initially\n   * @param {Object} drawerSettings opens a view in a drawer. Use these settings to configure if the drawer has a header, backdrop and size.\n   * @param {any} drawerSettings.header By default, the header is visible. The default title is the node label, but the header could also be an object with a `title` attribute allowing you to specify your own title.  An 'x' icon is displayed to close the drawer view.\n   * @param {boolean} drawerSettings.backdrop By default, it is set to `false`. If it is set to `true` the rest of the screen has a backdrop.\n   * @param {('l'|'m'|'s'|'xs')} [drawerSettings.size=\"s\"] size of the drawer\n   * @example\n   * LuigiClient.linkManager().navigate('/overview')\n   * LuigiClient.linkManager().navigate('users/groups/stakeholders')\n   * LuigiClient.linkManager().navigate('/settings', null, true) // preserve view\n   * LuigiClient.linkManager().navigate('#?Intent=Sales-order?id=13') // intent navigation\n   */\n  navigate(path, sessionId, preserveView, modalSettings, splitViewSettings, drawerSettings) {\n    if (this.options.errorSkipNavigation) {\n      this.options.errorSkipNavigation = false;\n      return;\n    }\n    if (modalSettings && splitViewSettings && drawerSettings) {\n      console.warn(\n        'modalSettings, splitViewSettings and drawerSettings cannot be used together. Only modal setting will be taken into account.'\n      );\n    }\n\n    this.options.preserveView = preserveView;\n    const relativePath = path[0] !== '/';\n\n    if (path === '/' && (modalSettings || splitViewSettings || drawerSettings)) {\n      console.warn('Navigation with an absolute path prevented.');\n      return;\n    }\n    const navigationOpenMsg = {\n      msg: 'luigi.navigation.open',\n      sessionId: sessionId,\n      params: Object.assign(this.options, {\n        link: path,\n        relative: relativePath,\n        intent: helpers.hasIntent(path),\n        modal: modalSettings,\n        splitView: splitViewSettings,\n        drawer: drawerSettings\n      })\n    };\n    helpers.sendPostMessageToLuigiCore(navigationOpenMsg);\n  }\n\n  /**\n   * Updates path of the modalPathParam when internal navigation occurs.\n   * @memberof linkManager\n   * @param {string} path\n   * @param {boolean} addHistoryEntry adds an entry in the history\n   * @param {Object} [modalSettings] opens a view in a modal. Use these settings to configure the modal's title and size\n   * @since 1.21.0\n   * @example\n   * LuigiClient.linkManager().updateModalPathInternalNavigation('microfrontend')\n   */\n  updateModalPathInternalNavigation(path, modalSettings = {}, addHistoryEntry = false) {\n    if (!path) {\n      console.warn('Updating path of the modal upon internal navigation prevented. No path specified.');\n      return;\n    }\n\n    const navigationOpenMsg = {\n      msg: 'luigi.navigation.updateModalDataPath',\n      params: Object.assign(this.options, {\n        link: path,\n        modal: modalSettings,\n        history: addHistoryEntry\n      })\n    };\n    helpers.sendPostMessageToLuigiCore(navigationOpenMsg);\n  }\n\n  /**\n   * Offers an alternative way of navigating with intents. This involves specifying a semanticSlug and an object containing\n   * parameters.\n   * This method internally generates a URL of the form `#?intent=<semantic object>-<action>?<param_name>=<param_value>` through the given\n   * input arguments. This then follows a call to the original `linkManager.navigate(...)` function.\n   * Consequently, the following calls shall have the exact same effect:\n   * - linkManager().navigateToIntent('Sales-settings', {project: 'pr2', user: 'john'})\n   * - linkManager().navigate('/#?intent=Sales-settings?project=pr2&user=john')\n   * @param {string} semanticSlug concatenation of semantic object and action connected with a dash (-), i.e.: `<semanticObject>-<action>`\n   * @param {Object} params an object representing all the parameters passed, i.e.: `{param1: '1', param2: 2, param3: 'value3'}`.\n   * @example\n   * LuigiClient.linkManager().navigateToIntent('Sales-settings', {project: 'pr2', user: 'john'})\n   * LuigiClient.linkManager().navigateToIntent('Sales-settings')\n   */\n  navigateToIntent(semanticSlug, params = {}) {\n    let newPath = '#?intent=';\n    newPath += semanticSlug;\n    if (params) {\n      const paramList = Object.entries(params);\n      // append parameters to the path if any\n      if (paramList.length > 0) {\n        newPath += '?';\n        for (const [key, value] of paramList) {\n          newPath += key + '=' + value + '&';\n        }\n        // trim potential excessive ampersand & at the end\n        newPath = newPath.slice(0, -1);\n      }\n    }\n    this.navigate(newPath);\n  }\n\n  /**\n   * Opens a view in a modal. You can specify the modal's title and size. If you don't specify the title, it is the node label. If there is no node label, the title remains empty.  The default size of the modal is `l`, which means 80%. You can also use `m` (60%) and `s` (40%) to set the modal size. Optionally, use it in combination with any of the navigation functions.\n   * @memberof linkManager\n   * @param {string} path navigation path\n   * @param {Object} [modalSettings] opens a view in a modal. Use these settings to configure the modal's title and size\n   * @param {string} modalSettings.title modal title. By default, it is the node label. If there is no label, it is left empty\n   * @param {('fullscreen'|'l'|'m'|'s')} [modalSettings.size=\"l\"] size of the modal\n   * @param {string} modalSettings.width lets you specify a precise width for the modal. Allowed units are 'px', '%', 'rem', 'em', 'vh' and 'vw'.\n   * @param {string} modalSettings.height lets you specify a precise height for the modal. Allowed units are 'px', '%', 'rem', 'em', 'vh' and 'vw'.\n   * @param {boolean} modalSettings.keepPrevious Lets you open multiple modals. Keeps the previously opened modal and allows to open another modal on top of the previous one. By default the previous modals are discarded.\n   * @example\n   * LuigiClient.linkManager().openAsModal('projects/pr1/users', {title:'Users', size:'m'});\n   */\n  openAsModal(path, modalSettings = {}) {\n    this.navigate(path, 0, true, modalSettings);\n  }\n\n  /**\n   * Update current title and size of a modal.\n   * @memberof linkManager\n   * @param {Object} updatedModalSettings possibility to update the active modal.\n   * @param {Object} updatedModalSettings.title update the `title` of the active modal.\n   * @param {Object} updatedModalSettings.size update the `size` of the active modal.\n   * @example\n   * LuigiClient.linkManager().updateModalSettings({title:'LuigiModal', size:'l'});\n   */\n  updateModalSettings(updatedModalSettings = {}) {\n    const message = {\n      msg: 'luigi.navigation.updateModalSettings',\n      updatedModalSettings\n    };\n    helpers.sendPostMessageToLuigiCore(message);\n  }\n\n  /**\n   * Opens a view in a split view. You can specify the split view's title and size. If you don't specify the title, it is the node label. If there is no node label, the title remains empty. The default size of the split view is `40`, which means 40% height of the split view.\n   * @memberof linkManager\n   * @param {string} path navigation path\n   * @param {Object} splitViewSettings opens a view in a split view. Use these settings to configure the split view's behaviour\n   * @param {string} splitViewSettings.title split view title. By default, it is the node label. If there is no label, it is left empty\n   * @param {number} [splitViewSettings.size=40] height of the split view in percent\n   * @param {boolean} [splitViewSettings.collapsed=false] opens split view in collapsed state\n   * @returns {Object} instance of the SplitView. It provides Event listeners and you can use the available functions to control its behavior.\n   * @see {@link splitView} for further documentation about the returned instance\n   * @since 0.6.0\n   * @example\n   * const splitViewHandle = LuigiClient.linkManager().openAsSplitView('projects/pr1/logs', {title: 'Logs', size: 40, collapsed: true});\n   */\n  openAsSplitView(path, splitViewSettings = {}) {\n    this.navigate(path, 0, true, undefined, splitViewSettings);\n    return new splitViewHandle(splitViewSettings);\n  }\n\n  /**\n   * Opens a view in a drawer. You can specify the size of the drawer, whether the drawer has a header, and whether a backdrop is active in the background. By default, the header is shown. The backdrop is not visible and has to be activated. The size of the drawer is set to `s` by default, which means 25% of the micro frontend size. You can also use `l`(75%), `m`(50%) or `xs`(15.5%). Optionally, use it in combination with any of the navigation functions.\n   * @memberof linkManager\n   * @param {string} path navigation path\n   * @param {Object} drawerSettings opens a view in a drawer. Use these settings to configure if the drawer has a header, backdrop and size.\n   * @param {any} drawerSettings.header By default, the header is visible. The default title is the node label, but the header could also be an object with a `title` attribute allowing you to specify your own title.  An 'x' icon is displayed to close the drawer view.\n   * @param {boolean} drawerSettings.backdrop By default, it is set to `false`. If it is set to `true` the rest of the screen has a backdrop.\n   * @param {('l'|'m'|'s'|'xs')} [drawerSettings.size=\"s\"] size of the drawer\n   * @param {boolean} [drawerSettings.overlap=true] enable resizing of main microfrontend iFrame after drawer open\n   * @since 1.6.0\n   * @example\n   * LuigiClient.linkManager().openAsDrawer('projects/pr1/drawer', {header:true, backdrop:true, size:'s'});\n   * LuigiClient.linkManager().openAsDrawer('projects/pr1/drawer', {header:{title:'My drawer component'}, backdrop:true, size:'xs'});\n   */\n  openAsDrawer(path, drawerSettings = {}) {\n    this.navigate(path, 0, true, undefined, undefined, drawerSettings);\n  }\n\n  /**\n   * Sets the current navigation context to that of a specific parent node which has the {@link navigation-configuration.md navigationContext} field declared in the navigation configuration. This navigation context is then used by the `navigate` function.\n   * @memberof linkManager\n   * @param {string} navigationContext\n   * @returns {linkManager} link manager instance\n   * @example\n   * LuigiClient.linkManager().fromContext('project').navigate('/settings')\n   */\n  fromContext(navigationContext) {\n    const navigationContextInParent =\n      this.currentContext.context.parentNavigationContexts &&\n      this.currentContext.context.parentNavigationContexts.indexOf(navigationContext) !== -1;\n    if (navigationContextInParent) {\n      this.options.fromContext = navigationContext;\n    } else {\n      this.options.errorSkipNavigation = true;\n      console.error('Navigation not possible, navigationContext ' + navigationContext + ' not found.');\n    }\n    return this;\n  }\n\n  /**\n   * Sets the current navigation context which is then used by the `navigate` function. This has to be a parent navigation context, it is not possible to use the child navigation contexts.\n   * @memberof linkManager\n   * @returns {linkManager} link manager instance\n   * @example\n   * LuigiClient.linkManager().fromClosestContext().navigate('/users/groups/stakeholders')\n   */\n  fromClosestContext() {\n    const hasParentNavigationContext =\n      this.currentContext && this.currentContext.context.parentNavigationContexts.length > 0;\n    if (hasParentNavigationContext) {\n      this.options.fromContext = null;\n      this.options.fromClosestContext = true;\n    } else {\n      console.error('Navigation not possible, no parent navigationContext found.');\n    }\n    return this;\n  }\n\n  /**\n   * Sets the current navigation base to the parent node that is defined as virtualTree. This method works only when the currently active micro frontend is inside a virtualTree.\n   * @memberof linkManager\n   * @returns {linkManager} link manager instance\n   * @since 1.0.1\n   * @example\n   * LuigiClient.linkManager().fromVirtualTreeRoot().navigate('/users/groups/stakeholders')\n   */\n  fromVirtualTreeRoot() {\n    this.options.fromContext = null;\n    this.options.fromClosestContext = false;\n    this.options.fromVirtualTreeRoot = true;\n    return this;\n  }\n\n  /**\n   * Enables navigating to sibling nodes without knowing the absolute path.\n   * @memberof linkManager\n   * @returns {linkManager} link manager instance\n   * @since 1.0.1\n   * @example\n   * LuigiClient.linkManager().fromParent().navigate('/sibling')\n   */\n  fromParent() {\n    this.options.fromParent = true;\n    return this;\n  }\n\n  /**\n   * Sends node parameters to the route. The parameters are used by the `navigate` function. Use it optionally in combination with any of the navigation functions and receive it as part of the context object in Luigi Client.\n   * @memberof linkManager\n   * @param {Object} nodeParams\n   * @returns {linkManager} link manager instance\n   * @example\n   * LuigiClient.linkManager().withParams({foo: \"bar\"}).navigate(\"path\")\n   *\n   * // Can be chained with context setting functions such as:\n   * LuigiClient.linkManager().fromContext(\"currentTeam\").withParams({foo: \"bar\"}).navigate(\"path\")\n   */\n  withParams(nodeParams) {\n    if (nodeParams) {\n      Object.assign(this.options.nodeParams, nodeParams);\n    }\n    return this;\n  }\n\n  /**\n   * Sets options to customise route changing behaviour. The parameters are used by the `navigate` function. Use it optionally in combination with any of the navigation functions and receive it as part of the context object in Luigi Client.\n   * @memberof linkManager\n   * @param {Object} options navigation options\n   * @param {boolean} options.preventHistoryEntry By default, it is set to `false`. If it is set to `true`, there is no browser history being kept.\n   * @param {boolean} options.preventContextUpdate By default, it is set to `false`. If it is set to `true`, there is no context update being triggered.\n   * @returns {linkManager} link manager instance\n   * @since 1.25.0\n   * @example\n   * LuigiClient.linkManager().withOptions(\n   * { preventContextUpdate:true, preventHistoryEntry: true }\n   * ).navigate('/overview')\n   */\n  withOptions(options) {\n    if (!helpers.isObject(options)) return this;\n\n    if (options['preventHistoryEntry'] !== undefined) {\n      this.options.preventHistoryEntry = options['preventHistoryEntry'];\n    }\n\n    if (options['preventContextUpdate'] !== undefined) {\n      this.options.preventContextUpdate = options['preventContextUpdate'];\n    }\n\n    return this;\n  }\n\n  /** @lends linkManager */\n  /**\n   * Checks if the path you can navigate to exists in the main application. For example, you can use this helper method conditionally to display a DOM element like a button.\n   * @memberof linkManager\n   * @param {string} path path which existence you want to check\n   * @returns {promise} a promise which resolves to a Boolean variable specifying whether the path exists or not\n   * @example\n   *  let pathExists;\n   *  LuigiClient\n   *  .linkManager()\n   *  .pathExists('projects/pr2')\n   *  .then(\n   *    (pathExists) => {  }\n   *  );\n   */\n  pathExists(path) {\n    const currentId = helpers.getRandomId();\n    const pathExistsPromises = this.getPromise('pathExistsPromises') || {};\n    pathExistsPromises[currentId] = {\n      resolveFn: function() {},\n      then: function(resolveFn) {\n        this.resolveFn = resolveFn;\n      }\n    };\n    this.setPromise('pathExistsPromises', pathExistsPromises);\n\n    // register event listener, which will be cleaned up after this usage\n    helpers.addEventListener(\n      'luigi.navigation.pathExists.answer',\n      function(e, listenerId) {\n        const data = e.data.data;\n        const pathExistsPromises = this.getPromise('pathExistsPromises') || {};\n        if (data.correlationId === currentId) {\n          if (pathExistsPromises[data.correlationId]) {\n            pathExistsPromises[data.correlationId].resolveFn(data.pathExists);\n            delete pathExistsPromises[data.correlationId];\n            this.setPromise('pathExistsPromises', pathExistsPromises);\n          }\n          helpers.removeEventListener(listenerId);\n        }\n      }.bind(this)\n    );\n\n    const pathExistsMsg = {\n      msg: 'luigi.navigation.pathExists',\n      data: Object.assign(this.options, {\n        id: currentId,\n        link: path,\n        intent: helpers.hasIntent(path),\n        relative: path[0] !== '/'\n      })\n    };\n    helpers.sendPostMessageToLuigiCore(pathExistsMsg);\n    return pathExistsPromises[currentId];\n  }\n\n  /**\n   * Checks if there is one or more preserved views. You can use it to show a **back** button.\n   * @memberof linkManager\n   * @returns {boolean} indicating if there is a preserved view you can return to\n   */\n  hasBack() {\n    return !!this.currentContext.internal.modal || this.currentContext.internal.viewStackSize !== 0;\n  }\n\n  /**\n   * Discards the active view and navigates back to the last visited view. Works with preserved views, and also acts as the substitute of the browser **back** button. **goBackContext** is only available when using preserved views.\n   * @memberof linkManager\n   * @param {any} goBackValue data that is passed in the **goBackContext** field to the last visited view when using preserved views\n   * @example\n   * LuigiClient.linkManager().goBack({ foo: 'bar' });\n   * LuigiClient.linkManager().goBack(true);\n   */\n  goBack(goBackValue) {\n    helpers.sendPostMessageToLuigiCore({\n      msg: 'luigi.navigation.back',\n      goBackContext: goBackValue && JSON.stringify(goBackValue)\n    });\n  }\n\n  /**\n   * Disables the navigation handling for a single navigation request.\n   * It prevents Luigi Core from handling the URL change after `navigate()`.\n   * Used for auto-navigation.\n   * @since 0.7.7\n   * @example\n   * LuigiClient.linkManager().withoutSync().navigate('/projects/xy/foobar');\n   * LuigiClient.linkManager().withoutSync().fromClosestContext().navigate('settings');\n   */\n  withoutSync() {\n    this.options.withoutSync = true;\n    return this;\n  }\n\n  /**\n   * Enables navigating to a new tab.\n   * @since 1.16.0\n   * @example\n   * LuigiClient.linkManager().newTab().navigate('/projects/xy/foobar');\n   */\n  newTab() {\n    this.options.newTab = true;\n    return this;\n  }\n\n  /**\n   * Keeps the URL's query parameters for a navigation request.\n   * @param {boolean} preserve By default, it is set to `false`. If it is set to `true`, the URL's query parameters will be kept after navigation.\n   * @since 1.19.0\n   * @example\n   * LuigiClient.linkManager().preserveQueryParams(true).navigate('/projects/xy/foobar');\n   * LuigiClient.linkManager().preserveQueryParams(false).navigate('/projects/xy/foobar');\n   */\n  preserveQueryParams(preserve = false) {\n    this.options.preserveQueryParams = preserve;\n    return this;\n  }\n\n  /**\n   * Gets the luigi route associated with the current micro frontend.\n   * @returns {promise} a promise which resolves to a String value specifying the current luigi route\n   * @since 1.23.0\n   * @example\n   * LuigiClient.linkManager().getCurrentRoute();\n   * LuigiClient.linkManager().fromContext('project').getCurrentRoute();\n   * LuigiClient.linkManager().fromVirtualTreeRoot().getCurrentRoute();\n   */\n  getCurrentRoute() {\n    const currentId = helpers.getRandomId();\n\n    const currentRoutePromise = this.getPromise('getCurrentRoute') || {};\n    currentRoutePromise[currentId] = {\n      resolveFn: function() {},\n      then: function(resolveFn) {\n        this.resolveFn = resolveFn;\n      }\n    };\n\n    this.setPromise('getCurrentRoute', currentRoutePromise);\n\n    helpers.addEventListener('luigi.navigation.currentRoute.answer', (e, listenerId) => {\n      const data = e.data.data;\n      const currentRoutePromise = this.getPromise('getCurrentRoute') || {};\n\n      if (data.correlationId === currentId) {\n        if (currentRoutePromise[data.correlationId]) {\n          currentRoutePromise[data.correlationId].resolveFn(data.route);\n          delete currentRoutePromise[data.correlationId];\n          this.setPromise('getCurrentRoute', currentRoutePromise);\n        }\n        helpers.removeEventListener(listenerId);\n      }\n      helpers.removeEventListener(listenerId);\n    });\n\n    helpers.sendPostMessageToLuigiCore({\n      msg: 'luigi.navigation.currentRoute',\n      data: Object.assign(this.options, {\n        id: currentId\n      })\n    });\n\n    return currentRoutePromise[currentId];\n  }\n}\n","import { LuigiClientBase } from './baseClass';\nimport { lifecycleManager } from './lifecycleManager';\nimport { helpers } from './helpers';\n\n/**\n * Use the UX Manager to manage the appearance features in Luigi.\n * @name uxManager\n */\nclass UxManager extends LuigiClientBase {\n  /** @private */\n  constructor() {\n    super();\n    helpers.addEventListener('luigi.current-locale-changed', e => {\n      if (e.data.currentLocale && lifecycleManager.currentContext?.internal) {\n        lifecycleManager.currentContext.internal.currentLocale = e.data.currentLocale;\n        lifecycleManager._notifyUpdate();\n      }\n    });\n  }\n\n  /**\n   * Adds a backdrop with a loading indicator for the micro frontend frame. This overrides the {@link navigation-parameters-reference.md#node-parameters loadingIndicator.enabled} setting.\n   * @memberof uxManager\n   */\n  showLoadingIndicator() {\n    helpers.sendPostMessageToLuigiCore({ msg: 'luigi.show-loading-indicator' });\n  }\n\n  /**\n   * Removes the loading indicator. Use it after calling {@link #showLoadingIndicator showLoadingIndicator()} or to hide the indicator when you use the {@link navigation-parameters-reference.md#node-parameters loadingIndicator.hideAutomatically: false} node configuration.\n   * @memberof uxManager\n   */\n  hideLoadingIndicator() {\n    helpers.sendPostMessageToLuigiCore({ msg: 'luigi.hide-loading-indicator' });\n  }\n\n  /**\n   * Closes the currently opened micro frontend modal.\n   * @memberof uxManager\n   */\n  closeCurrentModal() {\n    helpers.sendPostMessageToLuigiCore({ msg: 'luigi.close-modal' });\n  }\n\n  /**\n   * Adds a backdrop to block the top and side navigation. It is based on the Fundamental UI Modal, which you can use in your micro frontend to achieve the same behavior.\n   * @memberof uxManager\n   */\n  addBackdrop() {\n    helpers.sendPostMessageToLuigiCore({ msg: 'luigi.add-backdrop' });\n  }\n  /**\n   * Removes the backdrop.\n   * @memberof uxManager\n   */\n  removeBackdrop() {\n    helpers.sendPostMessageToLuigiCore({ msg: 'luigi.remove-backdrop' });\n  }\n  /**\n   * This method informs the main application that there are unsaved changes in the current view in the iframe. It can be used to prevent navigation away from the current view, for example with form fields which were edited but not submitted. However, this functionality is not restricted to forms. If you use `withoutSync()` together with `setDirtyStatus()`, this is a special case in which the dirty state logic needs to be handled by the micro frontend. For example, if the user navigates with an Angular router, which would trigger `withoutSync()`, Angular needs to take care about dirty state, prevent the navigation and ask for permission to navigate away, through `uxManager().showConfirmationModal(settings)`.\n   * @param {boolean} isDirty indicates if there are any unsaved changes on the current page or in the component\n   * @memberof uxManager\n   */\n  setDirtyStatus(isDirty) {\n    helpers.sendPostMessageToLuigiCore({\n      msg: 'luigi.set-page-dirty',\n      dirty: isDirty\n    });\n  }\n  /**\n   * Shows a confirmation modal.\n   * @memberof uxManager\n   * @param {Object} settings the settings of the confirmation modal. If you don't provide any value for any of the fields, a default value is used\n   * @param {('confirmation'|'success'|'warning'|'error'|'information')} settings.type the content of the modal type. (Optional)\n   * @param {string} [settings.header=\"Confirmation\"] the content of the modal header\n   * @param {string} [settings.body=\"Are you sure you want to do this?\"] the content of the modal body. It supports HTML formatting elements such as `<br>`, `<b>`, `<strong>`, `<i>`, `<em>`, `<mark>`, `<small>`, `<del>`, `<ins>`, `<sub>`, `<sup>`.\n   * @param {string|false} [settings.buttonConfirm=\"Yes\"] the label for the modal confirmation button. If set to `false`, the button will not be shown.\n   * @param {string} [settings.buttonDismiss=\"No\"] the label for the modal dismiss button\n   * @returns {promise} which is resolved when accepting the confirmation modal and rejected when dismissing it\n   * @example\n   * import LuigiClient from '@luigi-project/client';\n   * const settings = {\n   *  type: \"confirmation\",\n   *  header: \"Confirmation\",\n   *  body: \"Are you sure you want to do this?\",\n   *  buttonConfirm: \"Yes\",\n   *  buttonDismiss: \"No\"\n   * }\n   * LuigiClient\n   *  .uxManager()\n   *  .showConfirmationModal(settings)\n   *  .then(() => {\n   *     // Logic to execute when the confirmation modal is dismissed\n   *  });\n   */\n  showConfirmationModal(settings) {\n    helpers.addEventListener('luigi.ux.confirmationModal.hide', (e, listenerId) => {\n      this.hideConfirmationModal(e.data.data);\n      helpers.removeEventListener(listenerId);\n    });\n    helpers.sendPostMessageToLuigiCore({\n      msg: 'luigi.ux.confirmationModal.show',\n      data: { settings }\n    });\n\n    const confirmationModalPromise = {};\n    confirmationModalPromise.promise = new Promise((resolve, reject) => {\n      confirmationModalPromise.resolveFn = resolve;\n      confirmationModalPromise.rejectFn = reject;\n    });\n    this.setPromise('confirmationModal', confirmationModalPromise);\n    return confirmationModalPromise.promise;\n  }\n\n  /**\n   * @private\n   * @memberof uxManager\n   * @param {Object} modal confirmed boolean value if ok or cancel has been pressed\n   */\n  hideConfirmationModal(modal) {\n    const promise = this.getPromise('confirmationModal');\n    if (promise) {\n      modal.confirmed ? promise.resolveFn() : promise.rejectFn();\n      this.setPromise('confirmationModal', undefined);\n    }\n  }\n\n  /**\n   * Shows an alert.\n   * @memberof uxManager\n   * @param {Object} settings the settings for the alert\n   * @param {string} settings.text the content of the alert. To add a link to the content, you have to set up the link in the `links` object. The key(s) in the `links` object must be used in the text to reference the links, wrapped in curly brackets with no spaces. If you don't specify any text, the alert is not displayed\n   * @param {('info'|'success'|'warning'|'error')} settings.type sets the type of alert\n   * @param {Object} settings.links provides links data\n   * @param {Object} settings.links.LINK_KEY object containing the data for a particular link. To properly render the link in the alert message refer to the description of the **settings.text** parameter\n   * @param {string} settings.links.LINK_KEY.text text which replaces the link identifier in the alert content\n   * @param {string} settings.links.LINK_KEY.url URL to navigate when you click the link. Currently, only internal links are supported in the form of relative or absolute paths\n   * @param {string} settings.links.LINK_KEY.dismissKey dismissKey which represents the key of the link.\n   * @param {number} settings.closeAfter (optional) time in milliseconds that tells Luigi when to close the Alert automatically. If not provided, the Alert will stay on until closed manually. It has to be greater than `100`\n   * @returns {promise} which is resolved when the alert is dismissed\n   * @example\n   * import LuigiClient from '@luigi-project/client';\n   * const settings = {\n   *  text: \"Ut enim ad minim veniam, {goToHome} quis nostrud exercitation ullamco {relativePath}. Duis aute irure dolor {goToOtherProject}\",\n   *  type: 'info',\n   *  links: {\n   *    goToHome: { text: 'homepage', url: '/overview' },\n   *    goToOtherProject: { text: 'other project', url: '/projects/pr2' },\n   *    relativePath: { text: 'relative hide side nav', url: 'hideSideNav' },\n   *    neverShowItAgain: { text: 'Never show it again', dismissKey: 'neverShowItAgain' }\n   *  },\n   *  closeAfter: 3000\n   * }\n   * LuigiClient\n   *  .uxManager()\n   *  .showAlert(settings)\n   *  .then(() => {\n   *     // Logic to execute when the alert is dismissed\n   *  });\n   */\n  showAlert(settings) {\n    helpers.addEventListener('luigi.ux.alert.hide', (e, listenerId) => {\n      this.hideAlert(e.data);\n      helpers.removeEventListener(listenerId);\n    });\n\n    //generate random ID\n    settings.id = helpers.getRandomId();\n    if (settings?.closeAfter < 100) {\n      console.warn(`Message with id='${settings.id}' has too small 'closeAfter' value. It needs to be at least 100ms.`);\n      settings.closeAfter = undefined;\n    }\n    helpers.sendPostMessageToLuigiCore({\n      msg: 'luigi.ux.alert.show',\n      data: { settings }\n    });\n\n    const alertPromises = this.getPromise('alerts') || {};\n    alertPromises[settings.id] = {};\n    alertPromises[settings.id].promise = new Promise(resolve => {\n      alertPromises[settings.id].resolveFn = resolve;\n    });\n    this.setPromise('alerts', alertPromises);\n    return alertPromises[settings.id].promise;\n  }\n  /**\n   * @private\n   * @memberof uxManager\n   * @param {Object} alertObj\n   * @param {string} alertObj.id alert id\n   * @param {string} alertObj.dismissKey key of the link\n   */\n  hideAlert({ id, dismissKey }) {\n    const alerts = this.getPromise('alerts');\n    if (id && alerts[id]) {\n      alerts[id].resolveFn(dismissKey ? dismissKey : id);\n      delete alerts[id];\n      this.setPromise('alerts', alerts);\n    }\n  }\n\n  /**\n   * Gets the current locale.\n   * @returns {string} current locale\n   * @memberof uxManager\n   */\n  getCurrentLocale() {\n    return lifecycleManager.currentContext?.internal?.currentLocale;\n  }\n\n  /**\n   * Sets current locale to the specified one.\n   *\n   * **NOTE:** this must be explicitly allowed on the navigation node level by setting `clientPermissions.changeCurrentLocale` to `true`. (See {@link navigation-parameters-reference.md Node parameters}.)\n   *\n   * @param {string} locale locale to be set as the current locale\n   * @memberof uxManager\n   */\n  setCurrentLocale(locale) {\n    if (locale) {\n      helpers.sendPostMessageToLuigiCore({\n        msg: 'luigi.ux.set-current-locale',\n        data: {\n          currentLocale: locale\n        }\n      });\n    }\n  }\n\n  /**\n   * Checks if the current micro frontend is displayed inside a split view\n   * @returns {boolean} indicating if it is loaded inside a split view\n   * @memberof uxManager\n   * @since 0.6.0\n   */\n  isSplitView() {\n    return lifecycleManager.currentContext?.internal?.splitView;\n  }\n\n  /**\n   * Checks if the current micro frontend is displayed inside a modal\n   * @returns {boolean} indicating if it is loaded inside a modal\n   * @memberof uxManager\n   * @since 0.6.0\n   */\n  isModal() {\n    return lifecycleManager.currentContext?.internal?.modal;\n  }\n\n  /**\n   * Checks if the current micro frontend is displayed inside a drawer\n   * @returns {boolean} indicating if it is loaded inside a drawer\n   * @memberof uxManager\n   * @since 1.26.0\n   */\n  isDrawer() {\n    return lifecycleManager.currentContext?.internal?.drawer;\n  }\n\n  /**\n   * Gets the current theme.\n   * @returns {*} current themeObj\n   * @memberof uxManager\n   */\n  getCurrentTheme() {\n    return lifecycleManager.currentContext?.internal?.currentTheme;\n  }\n}\nexport const uxManager = new UxManager();\n","import { LuigiClientBase } from './baseClass';\nimport { helpers } from './helpers';\n\nconst pendingOperation = new Map();\n\n/**\n * StorageManager allows you to use browser local storage of key/values. Every storage operation is sent to be managed by Luigi Core.\n * The idea is that different micro frontends can share or persist items using local storage, as long as they come from the same domain and follow the [same-origin policy](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy).\n * Since all storage operations are asynchronous (sending an event to Luigi Core that will reply once operation is finished), all the methods return Promises.\n * @name storageManager\n */\nclass StorageManager extends LuigiClientBase {\n  /** @private */\n  constructor() {\n    super();\n    this.storageEventProcessor = new StorageEventProcessor();\n    helpers.addEventListener('storage', (evt, listenerId) => this.storageEventProcessor.processEvent(evt, listenerId));\n  }\n\n  /**\n   * Stores an item for a specific key.\n   * @memberof storageManager\n   * @param {string} key key used to identify the value\n   * @param {Object} value item to store; object must be stringifyable\n   * @returns {Promise<void>} resolves an empty value when the storage operation is over. It will launch an error if storage is not supported, the value cannot be stringified, or if you are using a Luigi reserved key.\n   * @example\n   * LuigiClient.storageManager().setItem('keyExample','valueExample').then(() => console.log('Value stored'))\n   * @since 1.6.0\n   */\n  setItem(key, value) {\n    return new Promise((resolve, reject) => {\n      this.storageEventProcessor.execute(resolve, reject, 'setItem', {\n        key,\n        value\n      });\n    });\n  }\n\n  /**\n   * Retrieves an item for a specific key.\n   * @memberof storageManager\n   * @param {string} key used to identify the value\n   * @returns {Promise<Object>} resolves an item retrieved from storage. It will launch an error if storage is not supported.\n   * @example\n   * LuigiClient.storageManager().getItem('keyExample').then((value) => console.log);\n   * @since 1.6.0\n   */\n  getItem(key) {\n    return new Promise((resolve, reject) => {\n      this.storageEventProcessor.execute(resolve, reject, 'getItem', { key });\n    });\n  }\n\n  /**\n   * Removes an item for a specific key.\n   * @memberof storageManager\n   * @param {string} key used to identify the value\n   * @returns {Promise<Object>} resolves an item just removed from storage. It will launch an error if storage is not supported or if you are using a Luigi reserved key.\n   * @example\n   * LuigiClient.storageManager().removeItem('keyExample').then((value) => console.log(value + ' just removed')\n   * @since 1.6.0\n   */\n  removeItem(key) {\n    return new Promise((resolve, reject) => {\n      this.storageEventProcessor.execute(resolve, reject, 'removeItem', {\n        key\n      });\n    });\n  }\n\n  /**\n   * Clears all the storage key/values.\n   * @memberof storageManager\n   * @returns {Promise<void>} resolves when storage clear is over.\n   * @example\n   * LuigiClient.storageManager().clear().then(() => console.log('storage cleared'))\n   * @since 1.6.0\n   */\n  clear() {\n    return new Promise((resolve, reject) => {\n      this.storageEventProcessor.execute(resolve, reject, 'clear', {});\n    });\n  }\n\n  /**\n   * Checks if a key is present in storage.\n   * @memberof storageManager\n   * @param {string} key key in the storage\n   * @returns {Promise<boolean>} `true` if key is present, `false` if it is not\n   * @example\n   * LuigiClient.storageManager().has(key).then((present) => console.log('item is present '+present))\n   * @since 1.6.0\n   */\n  has(key) {\n    return new Promise((resolve, reject) => {\n      this.storageEventProcessor.execute(resolve, reject, 'has', { key });\n    });\n  }\n\n  /**\n   * Gets all the keys used in the storage.\n   * @memberof storageManager\n   * @returns {Promise<string[]>} keys currently present in the storage\n   * @example\n   * LuigiClient.storageManager().getAllKeys().then((keys) => console.log('keys are '+keys))\n   * @since 1.6.0\n   */\n  getAllKeys() {\n    return new Promise((resolve, reject) => {\n      this.storageEventProcessor.execute(resolve, reject, 'getAllKeys', {});\n    });\n  }\n}\n\nclass StorageEventProcessor {\n  processEvent(evt, listenerId) {\n    try {\n      const data = evt.data.data;\n      if (!pendingOperation.has(data.id)) {\n        console.log('Impossible to find Promise method for message ' + data.id);\n        return;\n      }\n      const promiseOperations = pendingOperation.get(data.id);\n      if (data.status === 'ERROR') {\n        promiseOperations.reject(data.result);\n      } else {\n        promiseOperations.resolve(data.result);\n      }\n      pendingOperation.delete(data.id);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  waitForSyncResult(id) {\n    let start = new Date().getTime();\n    while (!syncOperation.has(id)) {\n      let exec = new Date().getTime() - start;\n      if (exec > 10000) {\n        throw 'Storage operation is taking more than 1 second...Some problem with Luigi Core communication';\n      }\n    }\n    const result = syncOperation.get(id);\n    pendingOperation.delete(id);\n    return result;\n  }\n\n  execute(resolve, reject, operation, params) {\n    let id = helpers.getRandomId();\n    this.createPendingOperation(id, resolve, reject);\n    this.sendMessage(id, operation, params);\n  }\n\n  createPendingOperation(id, resolve, reject) {\n    pendingOperation.set(id, {\n      resolve,\n      reject\n    });\n  }\n  sendMessage(id, operation, params) {\n    helpers.sendPostMessageToLuigiCore({\n      msg: 'storage',\n      data: {\n        id,\n        operation,\n        params\n      }\n    });\n  }\n}\n\nexport const storageManager = new StorageManager();\n","import { lifecycleManager } from './lifecycleManager';\nimport { linkManager } from './linkManager';\nimport { uxManager } from './uxManager';\nimport { storageManager } from './storageManager';\nimport { helpers } from './helpers';\n\n/**\n * @name LuigiClient\n * @private\n */\nclass LuigiClient {\n  constructor() {\n    if (window !== window.top) {\n      if (window.document.head.getAttribute('disable-luigi-history-handling') !== 'true') {\n        history.pushState = history.replaceState.bind(history);\n      }\n      if (window.document.head.getAttribute('disable-luigi-runtime-error-handling') !== 'true') {\n        window.addEventListener('error', ({ filename, message, lineno, colno, error }) => {\n          const msg = {\n            msg: 'luigi-runtime-error-handling',\n            errorObj: { filename, message, lineno, colno, error }\n          };\n          helpers.sendPostMessageToLuigiCore(msg);\n        });\n      }\n    }\n  }\n\n  addInitListener(initFn) {\n    return lifecycleManager.addInitListener(initFn);\n  }\n  removeInitListener(id) {\n    return lifecycleManager.removeInitListener(id);\n  }\n  addContextUpdateListener(contextUpdatedFn) {\n    return lifecycleManager.addContextUpdateListener(contextUpdatedFn);\n  }\n  removeContextUpdateListener(id) {\n    return lifecycleManager.removeContextUpdateListener(id);\n  }\n  getToken() {\n    return lifecycleManager.getToken();\n  }\n  getEventData() {\n    return lifecycleManager.getEventData();\n  }\n  getContext() {\n    return lifecycleManager.getContext();\n  }\n  addNodeParams(params, keepBrowserHistory) {\n    return lifecycleManager.addNodeParams(params, keepBrowserHistory);\n  }\n  getNodeParams(shouldDesanitise) {\n    return lifecycleManager.getNodeParams(shouldDesanitise);\n  }\n  getActiveFeatureToggles() {\n    return lifecycleManager.getActiveFeatureToggles();\n  }\n  getPathParams() {\n    return lifecycleManager.getPathParams();\n  }\n  getCoreSearchParams() {\n    return lifecycleManager.getCoreSearchParams();\n  }\n  addCoreSearchParams(searchParams, keepBrowserHistory) {\n    return lifecycleManager.addCoreSearchParams(searchParams, keepBrowserHistory);\n  }\n  getClientPermissions() {\n    return lifecycleManager.getClientPermissions();\n  }\n  sendCustomMessage(message) {\n    return lifecycleManager.sendCustomMessage(message);\n  }\n  addCustomMessageListener(messageId, listener) {\n    return lifecycleManager.addCustomMessageListener(messageId, listener);\n  }\n  removeCustomMessageListener(listenerId) {\n    return lifecycleManager.removeCustomMessageListener(listenerId);\n  }\n  addInactiveListener(messageId, listener) {\n    return lifecycleManager.addInactiveListener(messageId, listener);\n  }\n  removeInactiveListener(listenerId) {\n    return lifecycleManager.removeInactiveListener(listenerId);\n  }\n  setTargetOrigin(origin) {\n    return lifecycleManager.setTargetOrigin(origin);\n  }\n  getUserSettings() {\n    return lifecycleManager.getUserSettings();\n  }\n  isLuigiClientInitialized() {\n    return lifecycleManager.isLuigiClientInitialized();\n  }\n  luigiClientInit() {\n    return lifecycleManager.luigiClientInit();\n  }\n  getAnchor() {\n    return lifecycleManager.getAnchor();\n  }\n  setAnchor(value) {\n    return lifecycleManager.setAnchor(value);\n  }\n\n  /**\n   * @private\n   */\n  linkManager() {\n    return new linkManager({\n      currentContext: lifecycleManager.currentContext\n    });\n  }\n  /**\n   * @private\n   */\n  uxManager() {\n    return uxManager;\n  }\n  /**\n   * @private\n   */\n  lifecycleManager() {\n    return lifecycleManager;\n  }\n  /**\n   * @private\n   */\n  storageManager() {\n    return storageManager;\n  }\n}\nexport default LuigiClient = new LuigiClient();\n"],"sourceRoot":""}